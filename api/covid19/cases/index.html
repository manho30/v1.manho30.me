<script>
const fetchVaxCSV = async () => {
  const baseUrl = "https://raw.githubusercontent.com/MoH-Malaysia/covid19-public/main/vaccination";
  const req = await fetch(`${baseUrl}/vax_malaysia.csv`);
  return await req.text();
};

const parseVaxCSV = async (csv, dates) => {
  const arr = csv.split(/\n/);
  return arr
      .filter((e) => {
        const data = e.split(",");
        return dates.includes(data[0]);
      })
      .map((e) => {
        const data = e.split(",");
        return {
          date: data[0],
          daily_partial: parseInt(data[1]),
          daily_full: parseInt(data[2]),
          daily_booster: parseInt(data[6]),
          cumul_partial: parseInt(data[7]),
          cumul_full: parseInt(data[8]),
          cumul: parseInt(data[9]),
          cumul_booster: parseInt(data[12]),
        };
      });
};

const getVaxData = async (dates) => {
  const csv = await fetchVaxCSV();
  return await parseVaxCSV(csv, dates);
};

document.write(GetVaxData("2021-12-31"));
</script>
